<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <style>

            body {
                color: lightgray
            }

            img {
                max-width: 200px!important;
                max-height: 200px!important;
            }

            span:hover,
            body,
            .btn-group {
                background-color: #303030;
            }

            #logs {
                background-color: #424242;
            }

            .btn-group button {
                color: white;
                padding: 10px 24px;
                cursor: pointer;
                float: left;
            }

            .on {
                background-color: #4CAF50;
            }
            .on:hover {
                background-color: #3e8e41;
            }

            .off {
                background-color: #AD2A1A;
            }

            .off:hover{
                background-color: #9A2617;
            }

            .btn-group button:not(:last-child) {
                border-right: none;
            }

            .btn-group:after {
                content: "";
                clear: both;
                display: table;
            }
        </style>
        <script src="/socket.io/socket.io.js"></script>
        <script type="text/javascript">
            let init = () => {
                const socket = io();
                const filterSettings = {
                    min: 0,
                    max: 5e+300
                };

                const filterStatus = {
                    chat: true,
                    commands: true,
                    system: true,
                    debug: true,
                    error: true,
                    shutdown: true
                };

                displayStatus = element => {
                    const name = element.getAttribute('name');
                    const status = filterStatus[name];
                    if (!defined(status) || !status)
                        return 'none';
                    const time = element.getAttribute('data-time');
                    if (time < filterSettings.min || time > filterSettings.max)
                        return 'none';
                    return 'block';
                };

                socket.on('logs', lines => document.getElementById('logs').innerHTML = lines.join(''));
                socket.on('clear', () => document.getElementById('logs').innerHTML = '');

                socket.on('display', html => {
                    document.getElementById('logs').innerHTML += html;
                    const element = document.getElementById('logs').lastChild;
                    element.style.display = displayStatus(element);
                });

                defined = (thing) => thing !== null && typeof thing !== 'undefined';

                /**
                 * @param {string} name
                 */
                filter = name => {
                    if (!defined(name))
                        return;
                    name = name.toLowerCase();
                    if (!defined(filterStatus[name]))
                        return;

                    filterStatus[name] = !filterStatus[name];
                    socket.emit('filter', {name: name, display: filterStatus[name]});
                    document.getElementById(name).className = filterStatus[name] ? 'on' : 'off';
                    const elements = document.getElementsByName(name);
                    for (let i = 0; i < elements.length; i++)
                        elements[i].style.display = displayStatus(elements[i]);
                };

                updateFilter = () => {
                    const min = new Date(document.getElementById('earliest-time').value).getTime();
                    const max = new Date(document.getElementById('latest-time').value).getTime();
                    filterSettings.min = min;
                    filterSettings.max = max;
                    const elements = document.getElementById('logs').children;
                    for (let i = 0; i < elements.length; i++)
                        elements[i].style.display = displayStatus(elements[i]);
                };
            };
            init();
            init = null;
        </script>
        <script type="text/javascript">
            document.addEventListener('DOMContentLoaded', function() {
                const scripts = document.getElementsByTagName('script');
                for(let i = 0; i < scripts.length; i++)
                    scripts[i].parentNode.removeChild(scripts[i]);
            }, false);
        </script>
        <title>Cytubebot webpage</title>
    </head>
    <body>
        <div class="btn-group" style="width:100%; height:5vh">
            <button id="chat" class="on" style="width:16.66666%" onClick='filter("Chat")'>Chat</button>
            <button id="commands" class="on" style="width:16.66666%" onClick='filter("Commands")'>Commands</button>
            <button id="system" class="on" style="width:16.66666%" onClick='filter("System")'>System</button>
            <button id="debug" class="on"  style="width:16.66666%" onClick='filter("Debug")'>Debug</button>
            <button id="error" class="on" style="width:16.66666%" onClick='filter("Error")'>Error</button>
            <button id="shutdown" class="on" style="width:16.66666%" onClick='filter("Shutdown")'>Shutdown</button>
        </div>
        <div>
            <div id="logs" style="overflow-x: hidden; overflow-y:scroll; height:94vh; margin:auto; width:83.33334%; float:left"></div>
            <div id="filter" style="width:16.66666%; float:left">
                <label for="earliest-time">Earliest log time</label>
                <input id="earliest-time" style="width:100%" value="1000-01-01T00:00" type="datetime-local"/>
                <label for="latest-time">Latest log time</label>
                <input id="latest-time" style="width:100%" value="3000-01-01T00:00" type="datetime-local"/>
                <button style="width:100%" class="btn-primary" onclick="updateFilter()">Update logs displayed</button>
            </div>
        </div>
    </body>
</html>